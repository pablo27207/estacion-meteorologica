<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GIPIS - Estaciones Meteorológicas</title>
    <!-- Base path for path-based routing (e.g., /weather/) -->
    <base href="/weather/">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <!-- Compiled Tailwind CSS -->
    <link rel="stylesheet" href="css/tailwind.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Leaflet for maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="css/app.css">
</head>

<body class="bg-slate-100 text-slate-800 font-sans">
    <!-- Sidebar -->
    <aside id="sidebar"
        class="fixed left-0 top-0 h-full w-64 bg-slate-900 text-white transform -translate-x-full md:translate-x-0 transition-all duration-300 z-50 flex flex-col">

        <!-- Logo and collapse button -->
        <div class="p-4 border-b border-slate-700 shrink-0">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-cloud-sun text-xl"></i>
                </div>
                <div class="sidebar-text flex-1 overflow-hidden">
                    <h1 class="font-bold text-lg">GIPIS</h1>
                    <p class="text-xs text-slate-400">Weather Stations</p>
                </div>
                <!-- Collapse button (desktop only) -->
                <button id="sidebar-collapse-btn" data-action="toggleSidebarCollapse"
                    class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-slate-700 transition"
                    title="Colapsar menú">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
        </div>

        <!-- Selector removed -->

        <nav class="p-4 flex-1 overflow-y-auto">
            <ul class="space-y-2">
                <li>
                    <a href="#" data-action="showView" data-view="dashboard"
                        class="nav-link active flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition">
                        <i class="fas fa-tachometer-alt w-5 flex-shrink-0"></i>
                        <span class="sidebar-text">Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-action="showView" data-view="stations"
                        class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition">
                        <i class="fas fa-broadcast-tower w-5 flex-shrink-0"></i>
                        <span class="sidebar-text">Estaciones</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-action="showView" data-view="alerts"
                        class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition">
                        <i class="fas fa-bell w-5 flex-shrink-0"></i>
                        <span class="sidebar-text">Alertas</span>
                        <span id="alert-badge"
                            class="sidebar-text ml-auto bg-red-500 text-xs px-2 py-0.5 rounded-full hidden">0</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-action="showView" data-view="compare"
                        class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition">
                        <i class="fas fa-chart-bar w-5 flex-shrink-0"></i>
                        <span class="sidebar-text">Comparar</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-action="showView" data-view="signal"
                        class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition">
                        <i class="fas fa-signal w-5 flex-shrink-0"></i>
                        <span class="sidebar-text">Señal LoRa</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-action="showView" data-view="settings"
                        class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition">
                        <i class="fas fa-cog w-5 flex-shrink-0"></i>
                        <span class="sidebar-text">Configuración</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Refresh and Status Footer -->
        <div class="p-4 border-t border-slate-700 shrink-0">
            <div class="mb-4 sidebar-text">
                <p class="text-xs text-slate-400 mb-2" id="last-update-text">Última actualización: --</p>
                <button data-action="refreshData"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white text-sm py-2 rounded-lg transition flex items-center justify-center gap-2">
                    <i class="fas fa-sync-alt"></i>
                    <span>Actualizar</span>
                </button>
            </div>
            <div class="flex items-center gap-2 text-sm mb-3" title="Estado del servidor">
                <span id="connection-indicator" class="w-3 h-3 rounded-full bg-gray-400 flex-shrink-0"></span>
                <span id="connection-text" class="sidebar-text text-slate-400 text-xs">Conectando...</span>
            </div>
            <!-- User Auth Section -->
            <div id="user-section" class="pt-3 border-t border-slate-700">
                <!-- Guest State -->
                <div id="auth-guest" class="flex gap-2">
                    <a href="login.html"
                        class="flex-1 text-center text-xs py-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition">
                        <i class="fas fa-sign-in-alt mr-1"></i><span class="sidebar-text">Entrar</span>
                    </a>
                    <a href="register.html"
                        class="flex-1 text-center text-xs py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition">
                        <i class="fas fa-user-plus mr-1"></i><span class="sidebar-text">Registro</span>
                    </a>
                </div>
                <!-- Logged In State (hidden by default) -->
                <div id="auth-user" class="hidden">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-sm"></i>
                        </div>
                        <div class="sidebar-text flex-1 overflow-hidden">
                            <p id="user-name" class="text-sm font-medium truncate">Usuario</p>
                            <p id="user-role" class="text-xs text-slate-400">Viewer</p>
                        </div>
                    </div>
                    <button id="logout-btn" data-action="logout"
                        class="w-full text-xs py-2 bg-slate-700 hover:bg-red-600 text-slate-300 hover:text-white rounded-lg transition flex items-center justify-center gap-2">
                        <i class="fas fa-sign-out-alt"></i>
                        <span class="sidebar-text">Cerrar Sesión</span>
                    </button>
                </div>
            </div>
        </div>
    </aside>

    <!-- Mobile header -->
    <header
        class="md:hidden fixed top-0 left-0 right-0 bg-slate-900 text-white p-4 z-40 flex items-center justify-between">
        <button data-action="toggleSidebar" class="text-xl">
            <i class="fas fa-bars"></i>
        </button>
        <h1 class="font-bold">GIPIS Weather</h1>
        <div id="mobile-status" class="w-3 h-3 rounded-full bg-gray-500"></div>
    </header>

    <!-- Main content -->
    <main id="main-content" class="md:ml-64 p-6 pt-20 md:pt-6 min-h-screen transition-all duration-300">

        <!-- DASHBOARD VIEW -->
        <section id="view-dashboard" class="view active">
            <h2 class="text-2xl font-bold text-slate-800">Dashboard</h2>
            <p class="text-slate-500 text-sm">Seleccione una estación en el mapa para ver sus datos.</p>
            </div>
            </div>

            <!-- Main Dashboard Layout: Map (3/4) + Stats (1/4) -->
            <!-- Use inline style for height to avoid Tailwind JIT issues with arbitrary values -->
            <!-- Responsive Dashboard Layout -->
            <!-- Responsive Dashboard Layout (Overlay Map) -->
            <style>
                @media (min-width: 1024px) {
                    #dashboard-container {
                        height: 650px;
                        position: relative;
                        /* Anchor for absolute children */
                        display: block !important;
                        /* Not flex on desktop, pure positioning */
                    }

                    /* Map takes full space */
                    #map-container {
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        width: 100% !important;
                        height: 100% !important;
                        flex: none !important;
                        box-shadow: none;
                        border: none;
                        z-index: 1;
                        border-radius: 12px;
                        overflow: hidden;
                    }

                    /* Stats overlay on the right */
                    #stats-container {
                        position: absolute;
                        right: 80px;
                        top: 20px;
                        bottom: 20px;
                        width: 320px !important;
                        /* Fixed width for card column */
                        height: auto !important;
                        max-height: calc(100% - 40px);
                        z-index: 10;
                        /* Glassmorphism */
                        background: rgba(255, 255, 255, 0.85);
                        backdrop-filter: blur(8px);
                        border-radius: 12px;
                        padding: 16px;
                        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
                        overflow-y: auto;
                    }
                }

                @media (max-width: 1023px) {
                    #dashboard-container {
                        height: auto;
                        display: flex !important;
                        flex-direction: column !important;
                    }

                    /* On mobile, map has fixed height, stats auto below */
                    #map-container {
                        height: 400px;
                        width: 100% !important;
                        position: relative;
                        z-index: 1;
                    }

                    #stats-container {
                        height: auto;
                        width: 100% !important;
                        background: transparent;
                        box-shadow: none;
                        padding: 0;
                    }
                }
            </style>

            <div id="dashboard-container" class="flex flex-col gap-6 mb-6">
                <!-- Map Container -->
                <div id="map-container"
                    class="w-full bg-white rounded-xl shadow-sm overflow-hidden border border-slate-200 relative">
                    <div id="dashboard-map" class="w-full h-full z-10"></div>
                </div>

                <!-- Stats Container -->
                <div id="stats-container" class="w-full flex flex-col gap-4 overflow-y-auto">
                    <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-blue-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-semibold text-slate-400 uppercase">Temp. Aire</p>
                                <p class="text-2xl font-bold text-slate-700 mt-1">
                                    <span id="val-temp-air">--</span>
                                    <span class="text-sm text-slate-400 font-normal">°C</span>
                                </p>
                            </div>
                            <div class="w-12 h-12 bg-blue-50 rounded-lg flex items-center justify-center text-blue-600">
                                <i class="fas fa-thermometer-half text-xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-cyan-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-semibold text-slate-400 uppercase">Hum. Aire</p>
                                <p class="text-2xl font-bold text-slate-700 mt-1">
                                    <span id="val-hum-air">--</span>
                                    <span class="text-sm text-slate-400 font-normal">%</span>
                                </p>
                            </div>
                            <div class="w-12 h-12 bg-cyan-50 rounded-lg flex items-center justify-center text-cyan-600">
                                <i class="fas fa-tint text-xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-amber-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-semibold text-slate-400 uppercase">Temp. Suelo</p>
                                <p class="text-2xl font-bold text-slate-700 mt-1">
                                    <span id="val-temp-soil">--</span>
                                    <span class="text-sm text-slate-400 font-normal">°C</span>
                                </p>
                            </div>
                            <div
                                class="w-12 h-12 bg-amber-50 rounded-lg flex items-center justify-center text-amber-600">
                                <i class="fas fa-temperature-low text-xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-emerald-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-semibold text-slate-400 uppercase">Hum. Suelo</p>
                                <p class="text-2xl font-bold text-slate-700 mt-1">
                                    <span id="val-vwc-soil">--</span>
                                    <span class="text-sm text-slate-400 font-normal">%</span>
                                </p>
                            </div>
                            <div
                                class="w-12 h-12 bg-emerald-50 rounded-lg flex items-center justify-center text-emerald-600">
                                <i class="fas fa-seedling text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div> <!-- End Stats Container -->
            </div>

            <!-- Charts -->
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-slate-700">Gráficos Históricos</h3>
                <select id="chart-period" class="border rounded-lg px-3 py-2 text-sm" data-action="changeChartPeriod">
                    <option value="24h" selected>Últimas 24 horas</option>
                    <option value="7d">Últimos 7 días</option>
                    <option value="30d">Últimos 30 días</option>
                </select>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl shadow-sm p-5">
                    <h3 class="text-slate-600 font-semibold mb-4">Temperatura Aire (°C)</h3>
                    <canvas id="chart-temp-air"></canvas>
                </div>
                <div class="bg-white rounded-xl shadow-sm p-5">
                    <h3 class="text-slate-600 font-semibold mb-4">Humedad Aire (%)</h3>
                    <canvas id="chart-hum-air"></canvas>
                </div>
                <div class="bg-white rounded-xl shadow-sm p-5">
                    <h3 class="text-slate-600 font-semibold mb-4">Temperatura Suelo (°C)</h3>
                    <canvas id="chart-temp-soil"></canvas>
                </div>
                <div class="bg-white rounded-xl shadow-sm p-5">
                    <h3 class="text-slate-600 font-semibold mb-4">Humedad Suelo VWC (%)</h3>
                    <canvas id="chart-vwc-soil"></canvas>
                </div>
            </div>
        </section>

        <!-- STATIONS VIEW -->
        <section id="view-stations" class="view hidden">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-slate-800">Estaciones</h2>
                <button data-action="showAddStationModal"
                    class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition flex items-center gap-2">
                    <i class="fas fa-plus"></i>
                    Nueva Estación
                </button>
            </div>

            <div id="stations-list" class="space-y-4">
                <!-- Populated dynamically -->
            </div>
        </section>

        <!-- ALERTS VIEW -->
        <section id="view-alerts" class="view hidden">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-slate-800">Alertas</h2>
                <button data-action="refreshAlerts"
                    class="bg-slate-200 text-slate-700 px-4 py-2 rounded-lg hover:bg-slate-300 transition">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>

            <!-- Alerts explanation -->
            <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6">
                <h3 class="font-semibold text-blue-800 mb-2"><i class="fas fa-info-circle mr-2"></i>¿Cuándo se generan
                    alertas?</h3>
                <ul class="text-sm text-blue-700 space-y-1">
                    <li><i class="fas fa-thermometer-full text-red-500 mr-2"></i><strong>Temperatura alta:</strong>
                        Cuando supera los 35°C</li>
                    <li><i class="fas fa-thermometer-empty text-blue-500 mr-2"></i><strong>Temperatura baja:</strong>
                        Cuando baja de 0°C (helada)</li>
                    <li><i class="fas fa-tint text-cyan-500 mr-2"></i><strong>Humedad aire alta:</strong> Superior al
                        90%</li>
                    <li><i class="fas fa-seedling text-amber-500 mr-2"></i><strong>Suelo seco:</strong> Humedad de suelo
                        menor al 20%</li>
                    <li><i class="fas fa-water text-emerald-500 mr-2"></i><strong>Suelo saturado:</strong> Humedad de
                        suelo mayor al 80%</li>
                </ul>
            </div>

            <div id="alerts-list" class="space-y-3">
                <!-- Populated dynamically -->
            </div>
        </section>

        <!-- COMPARE VIEW -->
        <section id="view-compare" class="view hidden">
            <h2 class="text-2xl font-bold text-slate-800 mb-6">Comparar Estaciones</h2>

            <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-slate-600 mb-2">Estaciones</label>
                        <select id="compare-stations" multiple class="w-full border rounded-lg p-2 h-32">
                            <!-- Populated dynamically -->
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-600 mb-2">Métrica</label>
                        <select id="compare-metric" class="w-full border rounded-lg p-2">
                            <option value="temp_air">Temperatura Aire</option>
                            <option value="hum_air">Humedad Aire</option>
                            <option value="temp_soil">Temperatura Suelo</option>
                            <option value="vwc_soil">Humedad Suelo (VWC)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-600 mb-2">Período</label>
                        <select id="compare-period" class="w-full border rounded-lg p-2">
                            <option value="1h">Última hora</option>
                            <option value="24h" selected>Últimas 24 horas</option>
                            <option value="7d">Últimos 7 días</option>
                        </select>
                    </div>
                </div>
                <button data-action="loadComparison"
                    class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">
                    Comparar
                </button>
            </div>

            <div class="bg-white rounded-xl shadow-sm p-6">
                <canvas id="chart-compare"></canvas>
            </div>
        </section>

        <!-- SIGNAL ANALYSIS VIEW -->
        <section id="view-signal" class="view hidden">
            <h2 class="text-2xl font-bold text-slate-800 mb-6">Análisis de Señal LoRa</h2>

            <div id="signal-no-station" class="hidden bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                <p class="text-yellow-700">Seleccione una estación específica para ver el análisis detallado de señal.
                </p>
            </div>

            <div id="signal-content">
                <!-- Metrics Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-blue-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-semibold text-slate-400 uppercase">RSSI Actual</p>
                                <p class="text-2xl font-bold text-slate-700 mt-1">
                                    <span id="val-rssi">--</span> <span
                                        class="text-sm font-normal text-slate-400">dBm</span>
                                </p>
                            </div>
                            <div class="w-10 h-10 bg-blue-50 rounded-lg flex items-center justify-center text-blue-600">
                                <i class="fas fa-signal"></i>
                            </div>
                        </div>
                        <p class="text-xs text-slate-400 mt-2" id="rssi-status">--</p>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-indigo-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-semibold text-slate-400 uppercase">SNR Actual</p>
                                <p class="text-2xl font-bold text-slate-700 mt-1">
                                    <span id="val-snr">--</span> <span
                                        class="text-sm font-normal text-slate-400">dB</span>
                                </p>
                            </div>
                            <div
                                class="w-10 h-10 bg-indigo-50 rounded-lg flex items-center justify-center text-indigo-600">
                                <i class="fas fa-wave-square"></i>
                            </div>
                        </div>
                        <p class="text-xs text-slate-400 mt-2" id="snr-status">--</p>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-emerald-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-semibold text-slate-400 uppercase">Paquetes Recibidos</p>
                                <p class="text-2xl font-bold text-slate-700 mt-1" id="val-packets">--</p>
                            </div>
                            <div
                                class="w-10 h-10 bg-emerald-50 rounded-lg flex items-center justify-center text-emerald-600">
                                <i class="fas fa-box-open"></i>
                            </div>
                        </div>
                        <p class="text-xs text-slate-400 mt-2">En el periodo mostrado</p>
                    </div>
                </div>

                <!-- Explanation -->
                <div class="bg-slate-50 border border-slate-200 rounded-xl p-4 mb-6">
                    <h3 class="font-semibold text-slate-700 mb-2"><i class="fas fa-info-circle mr-2"></i>Interpretación
                        de Valores</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div>
                            <h4 class="font-bold text-slate-600 mb-1">RSSI (Received Signal Strength Indicator)</h4>
                            <ul class="text-slate-500 space-y-1">
                                <li><span class="inline-block w-3 h-3 bg-green-500 rounded-full mr-1"></span> > -100
                                    dBm: Excelente</li>
                                <li><span class="inline-block w-3 h-3 bg-yellow-500 rounded-full mr-1"></span> -100 a
                                    -115 dBm: Media/Buena</li>
                                <li><span class="inline-block w-3 h-3 bg-red-500 rounded-full mr-1"></span>
                                    < -115 dBm: Débil (riesgo de pérdida)</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-bold text-slate-600 mb-1">SNR (Signal-to-Noise Ratio)</h4>
                            <ul class="text-slate-500 space-y-1">
                                <li><span class="inline-block w-3 h-3 bg-green-500 rounded-full mr-1"></span> > 0 dB:
                                    Señal clara</li>
                                <li><span class="inline-block w-3 h-3 bg-yellow-500 rounded-full mr-1"></span> -7 a 0
                                    dB: Ruido moderado</li>
                                <li><span class="inline-block w-3 h-3 bg-red-500 rounded-full mr-1"></span>
                                    < -7 dB: Mucho ruido (Límite LoRa)</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="grid grid-cols-1 gap-6">
                    <div class="bg-white rounded-xl shadow-sm p-5">
                        <h3 class="text-slate-600 font-semibold mb-4">Historial RSSI (dBm)</h3>
                        <canvas id="chart-rssi" height="80"></canvas>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-5">
                        <h3 class="text-slate-600 font-semibold mb-4">Historial SNR (dB)</h3>
                        <canvas id="chart-snr" height="80"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- SETTINGS VIEW -->
        <section id="view-settings" class="view hidden">
            <h2 class="text-2xl font-bold text-slate-800 mb-6">Configuración</h2>

            <div class="bg-white rounded-xl shadow-sm p-6 max-w-2xl">
                <h3 class="font-semibold text-slate-700 mb-4">Configuración de Estación Seleccionada</h3>

                <div id="station-config-form" class="space-y-4">
                    <p class="text-slate-500">Seleccione una estación en el menú lateral para ver su configuración.</p>
                </div>
            </div>
        </section>

    </main>

    <!-- Add Station Modal -->
    <div id="modal-add-station" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center">
        <div class="bg-white rounded-xl shadow-xl max-w-md w-full mx-4 p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-bold text-slate-800">Nueva Estación</h3>
                <button data-action="closeModal" data-modal="modal-add-station"
                    class="text-slate-400 hover:text-slate-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <form id="add-station-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-slate-600 mb-1">Nombre *</label>
                    <input type="text" name="name" required
                        class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-slate-600 mb-1">Descripción</label>
                    <textarea name="description"
                        class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
                        rows="2"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-slate-600 mb-1">Latitud</label>
                        <input type="number" name="location_lat" step="any"
                            class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-600 mb-1">Longitud</label>
                        <input type="number" name="location_lng" step="any"
                            class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-slate-600 mb-1">Altitud (m)</label>
                    <input type="number" name="altitude"
                        class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
                </div>

                <div class="flex gap-3 pt-4">
                    <button type="button" data-action="closeModal" data-modal="modal-add-station"
                        class="flex-1 bg-slate-200 text-slate-700 py-2 rounded-lg hover:bg-slate-300 transition">
                        Cancelar
                    </button>
                    <button type="submit"
                        class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
                        Crear Estación
                    </button>
                </div>
            </form>

            <!-- API Key result -->
            <div id="api-key-result" class="hidden mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                <p class="text-sm text-green-800 font-semibold mb-2">Estación creada exitosamente</p>
                <p class="text-xs text-green-700 mb-2">Guarde este API Key, no se mostrará de nuevo:</p>
                <code id="new-api-key" class="block bg-white p-2 rounded text-xs break-all border"></code>
                <button data-action="copyApiKey" class="mt-2 text-sm text-blue-600 hover:underline">
                    <i class="fas fa-copy"></i> Copiar
                </button>
            </div>
        </div>
    </div>

    <script src="js/toast.js"></script>
    <script type="module" src="js/main.js"></script>
</body>

</html>