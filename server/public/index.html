<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GIPIS - Estaciones Meteorológicas</title>
    <!-- Base path for path-based routing (e.g., /weather/) -->
    <base href="/weather/">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <!-- Compiled Tailwind CSS -->
    <link rel="stylesheet" href="css/tailwind.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/app.css">
</head>

<body class="bg-slate-100 text-slate-800 font-sans">
    <!-- Sidebar -->
    <aside id="sidebar"
        class="fixed left-0 top-0 h-full w-64 bg-slate-900 text-white transform -translate-x-full md:translate-x-0 transition-transform z-50">
        <div class="p-6 border-b border-slate-700">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                    <i class="fas fa-cloud-sun text-xl"></i>
                </div>
                <div>
                    <h1 class="font-bold text-lg">GIPIS</h1>
                    <p class="text-xs text-slate-400">Weather Stations</p>
                </div>
            </div>
        </div>

        <nav class="p-4">
            <ul class="space-y-2">
                <li>
                    <a href="#" data-action="showView" data-view="dashboard"
                        class="nav-link active flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition">
                        <i class="fas fa-tachometer-alt w-5"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-action="showView" data-view="stations"
                        class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition">
                        <i class="fas fa-broadcast-tower w-5"></i>
                        <span>Estaciones</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-action="showView" data-view="alerts"
                        class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition">
                        <i class="fas fa-bell w-5"></i>
                        <span>Alertas</span>
                        <span id="alert-badge"
                            class="ml-auto bg-red-500 text-xs px-2 py-0.5 rounded-full hidden">0</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-action="showView" data-view="compare"
                        class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition">
                        <i class="fas fa-chart-bar w-5"></i>
                        <span>Comparar</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-action="showView" data-view="settings"
                        class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition">
                        <i class="fas fa-cog w-5"></i>
                        <span>Configuración</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Station selector -->
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-slate-700">
            <label class="text-xs text-slate-400 uppercase tracking-wider mb-2 block">Estación Activa</label>
            <select id="station-selector"
                class="w-full bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                <option value="">Todas las estaciones</option>
            </select>
        </div>
    </aside>

    <!-- Mobile header -->
    <header
        class="md:hidden fixed top-0 left-0 right-0 bg-slate-900 text-white p-4 z-40 flex items-center justify-between">
        <button data-action="toggleSidebar" class="text-xl">
            <i class="fas fa-bars"></i>
        </button>
        <h1 class="font-bold">GIPIS Weather</h1>
        <div id="mobile-status" class="w-3 h-3 rounded-full bg-gray-500"></div>
    </header>

    <!-- Main content -->
    <main class="md:ml-64 p-6 pt-20 md:pt-6 min-h-screen">

        <!-- DASHBOARD VIEW -->
        <section id="view-dashboard" class="view active">
            <!-- Header -->
            <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-slate-800">Dashboard</h2>
                    <p class="text-slate-500 text-sm" id="last-update-text">Última actualización: --</p>
                </div>
                <div class="flex items-center gap-4 mt-4 md:mt-0">
                    <div class="flex items-center gap-2 text-sm">
                        <span id="connection-indicator" class="w-3 h-3 rounded-full bg-gray-400"></span>
                        <span id="connection-text" class="text-slate-500">Conectando...</span>
                    </div>
                    <button data-action="refreshData"
                        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition flex items-center gap-2">
                        <i class="fas fa-sync-alt"></i>
                        <span class="hidden md:inline">Actualizar</span>
                    </button>
                </div>
            </div>

            <!-- Stats cards -->
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-blue-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs font-semibold text-slate-400 uppercase">Temp. Aire</p>
                            <p class="text-2xl font-bold text-slate-700 mt-1">
                                <span id="val-temp-air">--</span>
                                <span class="text-sm text-slate-400 font-normal">°C</span>
                            </p>
                        </div>
                        <div class="w-12 h-12 bg-blue-50 rounded-lg flex items-center justify-center text-blue-600">
                            <i class="fas fa-thermometer-half text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-cyan-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs font-semibold text-slate-400 uppercase">Hum. Aire</p>
                            <p class="text-2xl font-bold text-slate-700 mt-1">
                                <span id="val-hum-air">--</span>
                                <span class="text-sm text-slate-400 font-normal">%</span>
                            </p>
                        </div>
                        <div class="w-12 h-12 bg-cyan-50 rounded-lg flex items-center justify-center text-cyan-600">
                            <i class="fas fa-tint text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-amber-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs font-semibold text-slate-400 uppercase">Temp. Suelo</p>
                            <p class="text-2xl font-bold text-slate-700 mt-1">
                                <span id="val-temp-soil">--</span>
                                <span class="text-sm text-slate-400 font-normal">°C</span>
                            </p>
                        </div>
                        <div class="w-12 h-12 bg-amber-50 rounded-lg flex items-center justify-center text-amber-600">
                            <i class="fas fa-temperature-low text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-emerald-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs font-semibold text-slate-400 uppercase">Hum. Suelo</p>
                            <p class="text-2xl font-bold text-slate-700 mt-1">
                                <span id="val-vwc-soil">--</span>
                                <span class="text-sm text-slate-400 font-normal">%</span>
                            </p>
                        </div>
                        <div
                            class="w-12 h-12 bg-emerald-50 rounded-lg flex items-center justify-center text-emerald-600">
                            <i class="fas fa-seedling text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Station cards grid -->
            <div id="stations-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 mb-6">
                <!-- Populated dynamically -->
            </div>

            <!-- Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl shadow-sm p-5">
                    <h3 class="text-slate-600 font-semibold mb-4">Temperatura Aire (24h)</h3>
                    <canvas id="chart-temp-air"></canvas>
                </div>
                <div class="bg-white rounded-xl shadow-sm p-5">
                    <h3 class="text-slate-600 font-semibold mb-4">Humedad Aire (24h)</h3>
                    <canvas id="chart-hum-air"></canvas>
                </div>
                <div class="bg-white rounded-xl shadow-sm p-5">
                    <h3 class="text-slate-600 font-semibold mb-4">Temperatura Suelo (24h)</h3>
                    <canvas id="chart-temp-soil"></canvas>
                </div>
                <div class="bg-white rounded-xl shadow-sm p-5">
                    <h3 class="text-slate-600 font-semibold mb-4">Humedad Suelo VWC (24h)</h3>
                    <canvas id="chart-vwc-soil"></canvas>
                </div>
            </div>
        </section>

        <!-- STATIONS VIEW -->
        <section id="view-stations" class="view hidden">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-slate-800">Estaciones</h2>
                <button data-action="showAddStationModal"
                    class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition flex items-center gap-2">
                    <i class="fas fa-plus"></i>
                    Nueva Estación
                </button>
            </div>

            <div id="stations-list" class="space-y-4">
                <!-- Populated dynamically -->
            </div>
        </section>

        <!-- ALERTS VIEW -->
        <section id="view-alerts" class="view hidden">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-slate-800">Alertas</h2>
                <button data-action="refreshAlerts"
                    class="bg-slate-200 text-slate-700 px-4 py-2 rounded-lg hover:bg-slate-300 transition">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>

            <div id="alerts-list" class="space-y-3">
                <!-- Populated dynamically -->
            </div>
        </section>

        <!-- COMPARE VIEW -->
        <section id="view-compare" class="view hidden">
            <h2 class="text-2xl font-bold text-slate-800 mb-6">Comparar Estaciones</h2>

            <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-slate-600 mb-2">Estaciones</label>
                        <select id="compare-stations" multiple class="w-full border rounded-lg p-2 h-32">
                            <!-- Populated dynamically -->
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-600 mb-2">Métrica</label>
                        <select id="compare-metric" class="w-full border rounded-lg p-2">
                            <option value="temp_air">Temperatura Aire</option>
                            <option value="hum_air">Humedad Aire</option>
                            <option value="temp_soil">Temperatura Suelo</option>
                            <option value="vwc_soil">Humedad Suelo (VWC)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-600 mb-2">Período</label>
                        <select id="compare-period" class="w-full border rounded-lg p-2">
                            <option value="1h">Última hora</option>
                            <option value="24h" selected>Últimas 24 horas</option>
                            <option value="7d">Últimos 7 días</option>
                        </select>
                    </div>
                </div>
                <button data-action="loadComparison"
                    class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">
                    Comparar
                </button>
            </div>

            <div class="bg-white rounded-xl shadow-sm p-6">
                <canvas id="chart-compare"></canvas>
            </div>
        </section>

        <!-- SETTINGS VIEW -->
        <section id="view-settings" class="view hidden">
            <h2 class="text-2xl font-bold text-slate-800 mb-6">Configuración</h2>

            <div class="bg-white rounded-xl shadow-sm p-6 max-w-2xl">
                <h3 class="font-semibold text-slate-700 mb-4">Configuración de Estación Seleccionada</h3>

                <div id="station-config-form" class="space-y-4">
                    <p class="text-slate-500">Seleccione una estación en el menú lateral para ver su configuración.</p>
                </div>
            </div>
        </section>

    </main>

    <!-- Add Station Modal -->
    <div id="modal-add-station" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center">
        <div class="bg-white rounded-xl shadow-xl max-w-md w-full mx-4 p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-bold text-slate-800">Nueva Estación</h3>
                <button data-action="closeModal" data-modal="modal-add-station"
                    class="text-slate-400 hover:text-slate-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <form id="add-station-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-slate-600 mb-1">Nombre *</label>
                    <input type="text" name="name" required
                        class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-slate-600 mb-1">Descripción</label>
                    <textarea name="description"
                        class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
                        rows="2"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-slate-600 mb-1">Latitud</label>
                        <input type="number" name="location_lat" step="any"
                            class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-600 mb-1">Longitud</label>
                        <input type="number" name="location_lng" step="any"
                            class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-slate-600 mb-1">Altitud (m)</label>
                    <input type="number" name="altitude"
                        class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
                </div>

                <div class="flex gap-3 pt-4">
                    <button type="button" data-action="closeModal" data-modal="modal-add-station"
                        class="flex-1 bg-slate-200 text-slate-700 py-2 rounded-lg hover:bg-slate-300 transition">
                        Cancelar
                    </button>
                    <button type="submit"
                        class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
                        Crear Estación
                    </button>
                </div>
            </form>

            <!-- API Key result -->
            <div id="api-key-result" class="hidden mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                <p class="text-sm text-green-800 font-semibold mb-2">Estación creada exitosamente</p>
                <p class="text-xs text-green-700 mb-2">Guarde este API Key, no se mostrará de nuevo:</p>
                <code id="new-api-key" class="block bg-white p-2 rounded text-xs break-all border"></code>
                <button data-action="copyApiKey" class="mt-2 text-sm text-blue-600 hover:underline">
                    <i class="fas fa-copy"></i> Copiar
                </button>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>

</html>